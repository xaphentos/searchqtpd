<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SearchQTPD - Images</title>
  <link rel="stylesheet" href="images.css">
  <link rel="icon" type="image/png" href="favicon.ico">
</head>
<body>

  <header>
    <a href="index.html" class="brand">Search<span class="highlight">QTPD</span></a>
    <form id="searchForm">
      <input type="search" id="queryInput" name="q" placeholder="Search images..." required />
      <button type="submit">Search</button>
    </form>
  </header>

  <nav class="tabs">
    <a href="results.html?q=">üåê All</a>
    <a href="images.html" class="active">üñºÔ∏è Images</a>
    <a href="faq.html">üí¨ Feedback</a>
  </nav>

  <main>
    <section class="results-grid" id="resultsContainer">
      <!-- Images will be inserted here -->
    </section>
  </main>

  <footer>
    <ul>
      <li><a href="about-project.html">About</a></li>
      <li><a href="version.html">Latest Version</a></li>
      <li><a href="index.html">Search</a></li>
    </ul>
  </footer>

<script>
async function fetchImageResults(query) {
  const container = document.getElementById("resultsContainer");
  container.innerHTML = "<p>Loading images...</p>";

  try {
    container.innerHTML = "";
    let found = false;

    // === 1. DuckDuckGo API ===
    const ddgRes = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_redirect=1&no_html=1`);
    const ddgData = await ddgRes.json();

    if (ddgData.RelatedTopics) {
      ddgData.RelatedTopics.forEach(topic => {
        const iconURL = topic.Icon?.URL;
        const firstURL = topic.FirstURL;
        const text = topic.Text;
        if (iconURL && firstURL && text) {
          const imgSrc = iconURL.startsWith("http") ? iconURL : `https://duckduckgo.com${iconURL}`;
          const article = document.createElement("article");
          article.classList.add("image-card");
          article.innerHTML = `
            <a href="${firstURL}" target="_blank" rel="noopener noreferrer">
              <img src="${imgSrc}" alt="${text}">
            </a>
            <p>${text}</p>
            <small>${new URL(firstURL).hostname}</small>
          `;
          container.appendChild(article);
          found = true;
        }
      });
    }

    // === 2. Wikipedia fallback ===
    if (!found) {
      const wikiRes = await fetch(`https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages|pageterms&generator=search&gsrsearch=${encodeURIComponent(query)}&gsrlimit=12&pilimit=12&pithumbsize=300`);
      const wikiData = await wikiRes.json();
      if (wikiData.query?.pages) {
        Object.values(wikiData.query.pages).forEach(page => {
          const thumb = page.thumbnail?.source;
          if (thumb) {
            const article = document.createElement("article");
            article.classList.add("image-card");
            article.innerHTML = `
              <a href="https://en.wikipedia.org/?curid=${page.pageid}" target="_blank" rel="noopener noreferrer">
                <img src="${thumb}" alt="${page.title}">
              </a>
              <p>${page.title}</p>
              <small>wikipedia.org</small>
            `;
            container.appendChild(article);
            found = true;
          }
        });
      }
    }

    if (!found) {
      container.innerHTML = "<p>No images found.</p>";
    }

  } catch (err) {
    console.error(err);
    container.innerHTML = "<p>Error fetching images.</p>";
  }
}

// === Search form submission ===
document.getElementById("searchForm").addEventListener("submit", e => {
  e.preventDefault();
  const query = document.getElementById("queryInput").value.trim();
  if (query) {
    window.location.href = `images.html?q=${encodeURIComponent(query)}`;
  }
});

// === Fetch images on page load if query exists ===
const params = new URLSearchParams(window.location.search);
const q = params.get("q");
if (q) {
  document.getElementById("queryInput").value = q;
  fetchImageResults(q);
}
</script>
</body>
</html>
