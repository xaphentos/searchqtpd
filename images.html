<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SearchQTPD - Images</title>
  <link rel="stylesheet" href="images.css">
  <link rel="icon" type="image/png" href="favicon.ico">
</head>
<body>
  <header>
    <a href="index.html" class="brand">Search<span class="highlight">QTD</span></a>
    <form id="searchForm">
      <input type="search" id="query" placeholder="Search images..." required>
      <button type="submit">Search</button>
    </form>
  </header>

  <nav class="tabs">
    <a href="index.html">üåê All</a>
    <a href="#" class="active">üñºÔ∏è Images</a>
    <a href="videos.html" class="unactive">üé• Videos</a>
    <a href="faq.html">üí¨ Feedback</a>
  </nav>

  <main>
    <div class="results" id="results"></div>
  </main>

  <footer>
    <ul>
      <li><a href="about-project.html">About</a></li>
      <li><a href="version.html">Latest Version</a></li>
      <li><a href="index.html">Search</a></li>
    </ul>
  </footer>

  <script>
    const form = document.getElementById('searchForm');
    const resultsDiv = document.getElementById('results');
    const queryInput = document.getElementById('query');

    // function to fetch and render images
    async function searchImages(query) {
      if (!query) return;
      resultsDiv.innerHTML = '<p>Loading images...</p>';

      try {
        const url = `https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&generator=search&gsrsearch=${encodeURIComponent(query)}&gsrlimit=20&prop=pageimages|info&pithumbsize=400&inprop=url`;
        const res = await fetch(url);
        const data = await res.json();

        const pages = data.query?.pages;
        if (!pages) {
          resultsDiv.innerHTML = '<p>No images found.</p>';
          return;
        }

        const imagesHTML = Object.values(pages).map(page => {
          if (!page.thumbnail) return '';
          return `
            <article>
              <a href="${page.fullurl}" target="_blank">
                <img src="${page.thumbnail.source}" alt="${page.title}">
              </a>
              <p>${page.title}</p>
            </article>
          `;
        }).join('');

        resultsDiv.innerHTML = imagesHTML || '<p>No images found.</p>';
      } catch (err) {
        console.error(err);
        resultsDiv.innerHTML = '<p>Error fetching images. Try again later.</p>';
      }
    }

    // handle form submission
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const query = queryInput.value.trim();
      if (!query) return;

      // update URL with ?q= parameter
      window.history.pushState({}, '', `?q=${encodeURIComponent(query)}`);
      searchImages(query);
    });

    // check if URL already has ?q= and auto-search
    const params = new URLSearchParams(window.location.search);
    const queryFromURL = params.get("q");
    if (queryFromURL) {
      queryInput.value = queryFromURL;
      searchImages(queryFromURL);
    }
  </script>
</body>
</html>
